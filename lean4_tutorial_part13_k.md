# Part 13-K: 쿠라토우스키의 정리와 그래프 채색 — 비평면 판별의 완전한 조건과 색칠하기

> **Rosen 이산수학 8판 · Section 10.7.3 ~ 10.8 기반**
> 『Mathematics in Lean』 + Lean 4 공식화

---

## 0. 들어가며: 이 파트에서 배울 것

Part 13-J에서는 **평면 그래프**의 정의, **오일러 공식**, 그리고 따름정리를 통해 $K_5$와 $K_{3,3}$이 비평면임을 보았다. 하지만 따름정리들은 **충분조건**만 제공했다 — $e \le 3v - 6$을 만족해도 비평면일 수 있었다.

이번 Part 13-K에서는:

1. **기본 세분할**(elementary subdivision)과 **위상동형**(homeomorphic) 그래프
2. **쿠라토우스키의 정리**: 비평면의 **필요충분조건** ($\leftrightarrow$!)
3. **그래프 채색**(graph coloring)의 정의
4. **색채수**(chromatic number) $\chi(G)$
5. **4색 정리**(four color theorem): 평면 그래프의 색채수 $\le 4$
6. 특수 그래프의 색채수: $K_n$, $K_{m,n}$, $C_n$
7. 채색의 응용: 기말시험 스케줄링, 주파수 할당

> **비유로 이해하기**:
> - 🔍 **쿠라토우스키 정리**: "비평면인지 완벽하게 판별하는 X레이"
> - 🎨 **그래프 채색**: "지도를 색칠할 때 인접한 나라는 다른 색으로!"

---

## 1. 기본 세분할과 위상동형 그래프

### 1.1 기본 세분할(elementary subdivision)이란?

그래프가 평면이면 한 모서리 $\{u, v\}$를 제거하고 새로운 꼭지점 $w$와 모서리 $\{u, w\}$와 $\{w, v\}$를 추가해서 얻어질 수 있는 그래프도 평면이다. 이와 같은 연산을 **기본 세분할**(elementary subdivision)이라 한다.

```
   원래:    u ─────── v        세분할 후:  u ── w ── v
   (모서리 1개)                  (모서리 2개, 중간에 꼭지점 추가)
```

직관적으로, 모서리 중간에 **경유지**를 하나 추가하는 것이다. 도로에 휴게소를 추가하는 것과 비슷하다! 🏪

### 1.2 위상동형(homeomorphic) 그래프

> **정의**
>
> 그래프 $G_1 = (V_1, E_1)$과 $G_2 = (V_2, E_2)$는 같은 그래프로부터 일련의 기본 세분할에 의해 얻어질 수 있다면 **위상동형**(homeomorphic)이라 한다.

```lean
-- 위상동형의 기본 아이디어:
-- 모서리 중간에 꼭지점을 추가/제거해도 "본질적으로" 같은 그래프

-- 기본 세분할: 모서리 {u,v}를 {u,w}, {w,v}로 교체
-- 역연산: 차수 2인 꼭지점 w를 제거하고 양쪽을 직접 연결
```

### 1.3 예제 7: 위상동형 확인

```
  G₁:         G₂:            G₃:
  a───b       a───b          a──────b
  │ ╲ │       │╲  │╲         │╲   ╱│╲
  │  ╲│       │ f  │ h       │  i   │ k
  c───d───e   │╱ ╲│╱ ╲      │╱   ╲│╱ ╲
              c──g──d───e    c──────d───e
```

$G_1$으로부터 $G_2$를 얻기 위해서는 다음 일련의 기본 분할을 사용할 수 있다:
- (i) 모서리 $\{a, c\}$를 제거, 꼭지점 $f$를 추가 그리고 모서리 $\{a, f\}$와 $\{f, c\}$를 추가
- (ii) 모서리 $\{b, c\}$를 제거, 꼭지점 $g$를 추가 그리고 모서리 $\{b, g\}$와 $\{g, c\}$를 추가
- (iii) 모서리 $\{b, g\}$를 제거, 꼭지점 $h$를 추가 그리고 모서리 $\{g, h\}$, $\{b, h\}$를 추가

$G_1$으로부터 $G_3$를 구하는 기본 분할 과정은 여러분이 해보기 바란다.

---

## 2. 쿠라토우스키의 정리 — 비평면의 필요충분조건

### 2.1 정리

폴란드 수학자 카지미에쯔 쿠라토우스키(Kazimierz Kuratowski, 1896~1980)는 1930년에 다음 정리를 설명했다.

> **정리 2** (쿠라토우스키의 정리, Kuratowski's Theorem)
>
> 그래프가 $K_{3,3}$ 또는 $K_5$에 **위상동형인 부분그래프를 포함**한다면 **비평면**(nonplanar) 그래프이다. **그 역도 성립한다.**

이것은 **↔(iff)** — 즉 **필요충분조건**이다!

```
비평면 ↔ K₃,₃ 또는 K₅에 위상동형인 부분그래프를 포함
```

Part 13-J에서 배운 따름정리들과 비교하면:

| 조건 | 방향 | 유용성 |
|:---|:---|:---|
| 따름정리 1: $e > 3v - 6$ → 비평면 | → (한 방향) | 일부 비평면 판별 |
| 따름정리 3: $e > 2v - 4$ → 비평면 | → (한 방향) | 이분 그래프에 유용 |
| **쿠라토우스키**: 비평면 ↔ $K_{3,3}$/$K_5$ 위상동형 포함 | **↔ (양방향)** | **완전한 판별!** |

> **핵심**: 쿠라토우스키의 정리는 모든 비평면 그래프가 결국 $K_{3,3}$ 또는 $K_5$의 "변형판"을 내부에 포함한다는 놀라운 결과이다!

### 2.2 → vs ↔ 다시 한번!

```lean
-- → (if): 한 방향만 보장
-- 따름정리 1: isPlanar G → G.edgeCount ≤ 3 * G.vertexCount - 6
-- 대우: G.edgeCount > 3 * G.vertexCount - 6 → ¬isPlanar G

-- ↔ (iff): 양방향 보장
-- 쿠라토우스키: ¬isPlanar G ↔ containsK5orK33subdivision G

-- Lean 4에서 ↔의 사용:
-- h : P ↔ Q
-- h.mp : P → Q  (→ 방향)
-- h.mpr : Q → P  (← 방향)

-- 예: 쿠라토우스키 정리의 두 방향
-- kuratowski.mp  : ¬isPlanar G → containsK5orK33subdivision G  (어려운 방향)
-- kuratowski.mpr : containsK5orK33subdivision G → ¬isPlanar G  (쉬운 방향)
```

### 2.3 예제 8: 쿠라토우스키 정리 적용

그래프 $G$의 부분그래프 $H$는 $K_5$와 **위상동형**이다. $H$는 $h, j, k$를 제거하고 이 꼭지점들과 인접한 모든 모서리들을 제거하여 얻어진다. $H$는 $K_5$와 동형이다. 왜냐하면 $K_5$(꼭지점 $a, b, c, g, i$)는 일련의 기본 세분할, 꼭지점 $d, e, f$를 추가함으로 구해질 수 있기 때문이다. 그러므로 $G$는 **비평면**이다.

### 2.4 예제 9: 피터슨 그래프의 비평면성

**피터슨 그래프**(Petersen graph)는 그래프 이론에서 매우 유명한 그래프이다. (덴마크 수학자 줄리어스 피터슨이 1891년에 이 그래프에 대하여 연구하였으며, 그래프들의 많은 이론적인 성질을 설명하는데, 피터슨 그래프가 자주 활용된다.)

피터슨 그래프의 부분그래프 $H$는 $K_{3,3}$과 동형인 부분그래프를 포함한다. 기본 세분할에 의해 구해진 것이다. 그러므로 피터슨 그래프는 **비평면**이다.

---

## 3. 그래프 채색의 정의

### 3.1 지도 색칠 문제

세계지도와 같은 지도의 지역을 구분하여 색칠하는 것과 관련된 문제는 그래프 이론 분야에 큰 성과를 가져다 주었다. 지도를 색칠할 때 경계를 공유하는 두 영역은 보통 다른 색깔로 칠한다.

인접한 영역을 같은 색깔을 갖지 않도록 지도를 색칠하는 데 필요한 색깔의 최소수를 결정하는 문제를 고려해 보라.

> **핵심**: 지도의 각 영역 → 그래프의 꼭지점, 인접한 영역 쌍 → 모서리로 표현하면, 지도 색칠 = 그래프 채색!

지도의 **쌍대 그래프**(dual graph): 지도의 쌍대 그래프가 만들어지는 특성상, 평면 위에 그려진 모든 지도는 평면 쌍대 그래프를 갖는다.

### 3.2 채색과 색채수의 정의

> **정의 1** (Rosen 10.8)
>
> 단순 그래프의 **채색**(coloring)은 두 **인접 꼭지점**들은 같은 색깔을 할당하지 않도록 그래프의 각 꼭지점에 색상을 할당하는 것이다.

> **정의 2**
>
> 그래프의 **색채수**(chromatic number)는 그래프를 채색하기 위해 필요한 색의 **최소수**를 말한다. 그래프 $G$의 색채수는 $\chi(G)$를 나타낸다. (여기서 $\chi$는 그리스 문자 카이이다.)

```lean
-- 그래프 채색의 형식화
def IsProperColoring {V : Type*} (G : SimpleGraph V)
    (Color : Type*) (f : V → Color) : Prop :=
  ∀ u v : V, G.Adj u v → f u ≠ f v
```

색채수가 $k$임을 증명하려면 두 가지를 보여야 한다:
1. $k$개의 색상으로 색칠할 수 있음 (상한)
2. $k-1$개의 색상으로는 색칠할 수 없음 (하한)

---

## 4. 특수 그래프의 색채수

### 4.1 $K_n$의 색채수

$$\chi(K_n) = n$$

모든 꼭지점이 서로 인접하므로 모든 꼭지점에 다른 색이 필요하다.

### 4.2 $K_{m,n}$의 색채수

$$\chi(K_{m,n}) = 2 \quad (m, n \ge 1)$$

이분 그래프이므로 2색이면 충분하다. 한 그룹을 빨강, 다른 그룹을 파랑으로!

### 4.3 $C_n$의 색채수

$$\chi(C_n) = \begin{cases} 2 & n \ge 4 \text{이고 } n \text{이 짝수} \\ 3 & n \ge 3 \text{이고 } n \text{이 홀수} \end{cases}$$

**짝수 순환**: Red, Blue 교대로 칠하면 끝! $n$번째 꼭지점은 파란색으로 색칠할 수 있다. 왜냐하면 그것에 인접한 두 꼭지점들 즉, 첫 번째 꼭지점과 $(n-1)$번째 꼭지점은 둘 다 빨간색이기 때문이다.

**홀수 순환**: 두 색만으로는 불가능! 마지막 꼭지점에서 양 이웃이 서로 다른 색이므로 세 번째 색이 필요하다.

```lean
-- 짝수 순환: 2색 교대
-- C₆: R → B → R → B → R → B → (다시 R에 인접하는 B) ✅

-- 홀수 순환: 3색 필요
-- C₅: R → B → R → B → ??? (R과 B에 모두 인접!) → Yellow 필요
```

---

## 5. 4색 정리

> **정리 1** (4색 정리, Four Color Theorem)
>
> **평면 그래프**의 색채수는 **4보다 크지 않다.**

### 5.1 역사

- **1852년**: 프란시스 거스리가 4색 추측을 제시
- **1879년**: 켐프가 잘못된 증명 발표
- **1890년**: 히우드가 오류 발견
- **1976년**: 아펠과 하켄이 **컴퓨터 보조 증명**으로 최종 증명 (약 2,000개 유형 검사, 1,000시간 이상 컴퓨터 사용)

> **논쟁**: 컴퓨터가 핵심 역할을 했기 때문에 "진짜 증명인가?"라는 논쟁이 있었다. 컴퓨터에 의존하지 않는 증명법은 아직 발견되지 않았다.

4색 이론은 단지 **평면 그래프에만** 적용된다. 비평면 그래프는 임의의 큰 색채수를 가질 수 있다.

---

## 6. 그래프 채색의 응용

### 6.1 기말시험 스케줄링 (예제 5)

- **꼭지점** = 교과목, **모서리** = 공통학생이 있는 교과목 쌍
- **채색** = 시간대 배정
- 색채수 = 필요한 최소 시간대 수

### 6.2 주파수 할당 (예제 6)

- **꼭지점** = 방송국, **모서리** = 150마일 이내의 방송국 쌍
- 채널 할당은 그래프 채색에 대응

### 6.3 인덱스 레지스터 할당 (예제 7)

- **꼭지점** = 루프 내의 변수, **모서리** = 동시에 레지스터에 있어야 하는 변수 쌍
- 색채수 = 필요한 레지스터 수

---

## 7. 연습 문제

### 연습 7.1: 경로 그래프의 색채수 (빈칸 채우기)

**문제**: $P_n$ ($n \ge 2$)의 색채수는?

```lean
-- χ(Pₙ) = ⟨??⟩
```

<details>
<summary>📝 답 보기</summary>

$\chi(P_n) = 2$ (경로 그래프는 이분 그래프이므로 2색이면 충분!)

</details>

### 연습 7.2: $W_5$의 색채수 (빈칸 채우기)

**문제**: 바퀴 그래프 $W_5$의 색채수는?

```lean
-- 외곽: C₅ (홀수 순환 → 3색), 중앙: 외곽 전체와 인접
-- χ(W₅) = ⟨??⟩
```

<details>
<summary>📝 답 보기</summary>

$\chi(W_5) = 4$ (외곽 $C_5$에 3색 + 중앙에 4번째 색)

</details>

### 연습 7.3: 비평면 필요충분조건 선택 (빈칸 채우기)

**문제**: 비평면의 **필요충분조건**은? (A) $e > 3v - 6$ (B) $K_{3,3}$ 또는 $K_5$ 위상동형 포함 (C) 차수 6 이상 존재 (D) $\chi(G) > 4$

<details>
<summary>📝 답 보기</summary>

**(B)** — 쿠라토우스키의 정리! (A)는 충분조건만, (C)는 무관, (D)는 충분조건만.

</details>

### 연습 7.4: $C_8$의 색채수 (sorry)

```lean
-- C₈: 짝수/홀수?  χ(C₈) = ?
theorem chromatic_C8 : sorry := by sorry
```

<details>
<summary>📝 답 보기</summary>

$\chi(C_8) = 2$ (8은 짝수 → 2색 교대)

```lean
example : 8 % 2 = 0 := by norm_num  -- 8은 짝수 ✅
```

</details>

### 연습 7.5: $K_{5,5}$ 비평면 판별 (sorry)

```lean
-- K₅,₅: v = 10, e = 25, 이분 → 삼각형 없음 → 따름정리 3
-- 2v - 4 = ?,  e > 2v - 4?
theorem K55_nonplanar : sorry := by sorry
```

<details>
<summary>📝 답 보기</summary>

```lean
example : 25 > 2 * 10 - 4 := by norm_num  -- 25 > 16 → 비평면!
```

</details>

### 연습 7.6: $K_{3,4}$의 2-채색 정의 (sorry)

```lean
def K34_coloring : Fin 7 → Fin 2 := sorry
theorem K34_proper : sorry := by sorry
```

<details>
<summary>📝 답 보기</summary>

```lean
def K34_coloring : Fin 7 → Fin 2 :=
  fun v => if v.val < 3 then 0 else 1
-- 그룹 {0,1,2} → 색 0, 그룹 {3,4,5,6} → 색 1
-- 이분 그래프이므로 같은 그룹 내 인접 없음 → 적절한 채색!
```

</details>

### 연습 7.7: 연결 평면 그래프 문제 (sorry)

**문제**: 연결 이분 평면 단순 그래프는 $e$개의 모서리들과 $v$개의 꼭지점들을 가진다고 하자. $v \ge 3$이면 $e \le 2v - 4$임을 보여라. (Rosen 연습문제 16)

```lean
-- 힌트: 이분 그래프 → 길이 3의 순환 없음 → 따름정리 3 적용
theorem bipartite_planar_bound : sorry := by sorry
```

<details>
<summary>📝 답 보기</summary>

이분 그래프는 홀수 길이의 순환을 포함하지 않으므로, 특히 길이 3의 순환(삼각형)이 없다. 따라서 따름정리 3을 직접 적용할 수 있다: $e \le 2v - 4$.

```lean
-- 따름정리 3의 조건: 삼각형 없는 연결 평면 단순 그래프
-- 이분 그래프 → 삼각형 없음 (홀수 순환 없음)
-- 따라서 e ≤ 2v - 4 성립!
```

</details>

### 연습 7.8: $K_n$의 비평면성 일반화 (sorry)

**문제**: $n \ge 5$인 모든 $K_n$이 비평면임을 보여라.

```lean
-- 힌트: K_n의 모서리 수 = n(n-1)/2, 3v - 6 = 3n - 6
-- n ≥ 5이면 n(n-1)/2 > 3n - 6?
theorem Kn_nonplanar (n : ℕ) (hn : n ≥ 5) : sorry := by sorry
```

<details>
<summary>📝 답 보기</summary>

$K_n$: $v = n$, $e = n(n-1)/2$

$n \ge 5$일 때:
- $3v - 6 = 3n - 6$
- $e = n(n-1)/2$
- $n(n-1)/2 > 3n - 6$인지 확인: $n^2 - n > 6n - 12$, 즉 $n^2 - 7n + 12 > 0$, 즉 $(n-3)(n-4) > 0$
- $n \ge 5$이면 $(n-3) \ge 2, (n-4) \ge 1$이므로 성립!

```lean
-- n ≥ 5이면 n(n-1)/2 > 3n - 6
-- ↔ n² - n > 6n - 12
-- ↔ n² - 7n + 12 > 0
-- ↔ (n-3)(n-4) > 0
-- n ≥ 5이면 n-3 ≥ 2, n-4 ≥ 1이므로 참!
```

</details>

---

## 8. 핵심 요약

1. **기본 세분할**(elementary subdivision): 모서리 중간에 꼭지점을 삽입하는 연산이다.
2. **위상동형**(homeomorphic): 같은 그래프에서 기본 세분할로 얻을 수 있는 그래프 쌍이다.
3. **쿠라토우스키의 정리**: 비평면 $\leftrightarrow$ $K_{3,3}$ 또는 $K_5$에 위상동형인 부분그래프 포함 — **필요충분조건**!
4. **채색**(coloring): 인접 꼭지점에 다른 색을 할당하는 것이다.
5. **색채수**(chromatic number) $\chi(G)$: 적절한 채색에 필요한 최소 색상 수이다.
6. $\chi(K_n) = n$, $\chi(K_{m,n}) = 2$, $\chi(C_n) = 2$(짝수) 또는 $3$(홀수).
7. **4색 정리**: 평면 그래프의 $\chi \le 4$ (컴퓨터 보조 증명, 1976년).
8. 채색의 응용: 시험 스케줄링, 주파수 할당, 레지스터 할당.
9. **→ vs ↔**: 따름정리 1은 $\to$(한 방향), 쿠라토우스키는 $\leftrightarrow$(양방향)!
10. **lemma**(디딤돌) → **theorem**(최종 결과) → **corollary**(쉽게 유도되는 정리).

---

## 9. 사용된 Lean 4 전술 정리

| 전술/키워드 | 용도 | 예시 |
|:---|:---|:---|
| `norm_num` | 수치 계산 | `example : 25 > 16 := by norm_num` |
| `omega` | 자연수/정수 부등식 | 선형 부등식 자동 해결 |
| `rw` | 치환 (슈퍼포지션) | `rw [h_euler] at h_deg` |
| `structure` | 구조체 정의 | `IsProperColoring` |
| `sorry` | 미완성 증명 | 복잡한 증명 자리 표시 |
| `fin_cases` | 유한 경우 나열 | 구체적 그래프 검증 |
| `decide` | 결정 가능 명제 | 유한 그래프의 성질 검증 |
| `.mp` / `.mpr` | ↔의 → / ← 방향 | `h.mp`, `h.mpr` |

---

> **축하합니다! 🎉** Part 13-K까지 완료하면 Rosen 이산수학 10장 (그래프 이론)의 핵심 내용을 모두 다룬 것이다! 평면 그래프, 오일러 공식, 쿠라토우스키 정리, 그래프 채색, 4색 정리까지 배웠다. 이 개념들은 컴퓨터 과학, 네트워크 설계, 회로 설계 등 다양한 분야의 기초가 된다.
