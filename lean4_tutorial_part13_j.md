# Part 13-J: 평면 그래프 — 교차 없이 평면에 그릴 수 있을까?

> **Rosen 이산수학 8판 · Section 10.7 기반**
> 『Mathematics in Lean』 + Lean 4 공식화

---

## 0. 들어가며: 이 파트에서 배울 것

Part 13-I에서는 **최단경로 문제**(다익스트라 알고리즘)를 배웠다. 이번 Part 13-J에서는 그래프를 **평면 위에** 모서리들이 교차하지 않도록 그릴 수 있는지를 묻는 **평면 그래프**(planar graph) 문제를 다룬다.

> **핵심 질문**: "이 그래프를 종이 위에 선이 겹치지 않게 그릴 수 있을까?"

이 파트에서 다루는 내용:

1. **평면 그래프**(planar graph)와 **평면 표현**(planar representation)의 정의
2. $K_4$와 $Q_3$가 평면 그래프임을 보이기
3. $K_{3,3}$이 **비평면**(nonplanar)임을 보이기
4. 평면 그래프의 **영역**(region)과 **면**(face)
5. **오일러 공식**(Euler's formula): $r = e - v + 2$
6. **따름정리 1**: $e \le 3v - 6$ (연결 평면 단순 그래프)
7. **따름정리 2**: 차수 5 이하인 꼭지점의 존재
8. **따름정리 3**: 삼각형 없는 그래프에서 $e \le 2v - 4$
9. $K_5$와 $K_{3,3}$이 비평면임을 증명하기
10. Lean 4에서 평면 그래프 관련 성질을 형식화하기

> **실생활 비유**: 
> 🔌 **집과 공공 시설 문제**: 3개의 집이 전기, 가스, 수도 3가지 시설에 각각 연결되어야 하는데, 연결선이 교차하지 않게 할 수 있을까? → $K_{3,3}$이 평면인지의 문제!
>
> 🖥️ **전자 회로 설계**: 인쇄 회로 기판(PCB)에서 연결선이 교차하면 안 된다. 교차가 필요하면 다층 기판을 써야 해서 비용이 증가한다 → 평면성 판별이 중요!

---

## 1. 평면 그래프의 정의

### 1.1 직관적 이해

**평면 그래프**(planar graph)란, 종이 위에 그렸을 때 **모서리들이 서로 교차하지 않게** 그릴 수 있는 그래프이다.

> 여기서 "교차"란 모서리들이 **꼭지점이 아닌 곳**에서 만나는 것을 의미한다. 꼭지점 위에서 만나는 것은 당연하므로 괜찮다!

비유하자면:
- **평면 그래프**: 실을 꼬이지 않게 풀 수 있는 매듭 🧵
- **비평면 그래프**: 아무리 해도 실이 꼬일 수밖에 없는 매듭 🪢

### 1.2 정식 정의

> **정의 1** (Rosen 10.7, Definition 1)
>
> 어떤 모서리도 교차하지 않도록 평면으로 그래프를 그릴 수 있다면, 그 그래프를 **평면 그래프**(planar graph)라 한다(여기서 모서리의 교차는 선이나 호들의 교차이다). 평면 그래프로 그린 그림을 그래프의 **평면 표현**(planar representation)이라 한다.

**핵심 포인트**: 보통 교차를 가진 그래프일지라도, 교차가 없도록 **다시 그릴 수 있으면** 평면 그래프가 될 수 있다!

### 1.3 Lean 4에서의 기본 설정

평면 그래프의 완전한 형식화는 위상수학적 개념(평면 매장 등)이 필요하여 매우 복잡하다. 여기서는 **조합적 성질**(오일러 공식, 모서리-꼭지점 부등식 등)에 초점을 맞춘다.

```lean
import Mathlib.Combinatorics.SimpleGraph.Basic
import Mathlib.Combinatorics.SimpleGraph.Finite
import Mathlib.Data.Finset.Basic
import Mathlib.Tactic

open SimpleGraph Finset

-- 평면 그래프의 조합적 성질을 담는 구조체
-- (실제 평면성 판별은 위상적이므로, 여기서는 조합적 제약으로 근사한다)
structure PlanarGraphData (V : Type*) [Fintype V] [DecidableEq V] where
  G : SimpleGraph V                    -- 기반 그래프
  [decAdj : DecidableRel G.Adj]        -- 인접성이 결정 가능
  numVertices : ℕ                      -- 꼭지점 수 v
  numEdges : ℕ                         -- 모서리 수 e
  numRegions : ℕ                       -- 영역 수 r (평면 표현에서)
  isConnected : Bool                   -- 연결 여부
```

> **참고**: Mathlib에는 아직 평면 그래프에 대한 완전한 형식화가 없다. 위상적 매장(topological embedding)을 다루려면 대수적 위상수학(algebraic topology) 라이브러리가 필요하다. 우리는 **조합적 성질**을 증명하는 데 집중한다.

---

## 2. 평면 그래프의 예제

### 2.1 예제 1: $K_4$는 평면 그래프인가?

**완전 그래프** $K_4$는 4개의 꼭지점과 6개의 모서리를 가진다.

```
  보통 그린 K₄:         교차 없이 그린 K₄:
      a                      a
     /│╲                    / ╲
    / │ ╲                  /   ╲
   b──┼──c                b─────c
    ╲ │ ╱                  ╲   ╱
     ╲│╱                    ╲ ╱
      d                      d
                        (d를 삼각형 안에!)
```

보통 그리면 2개의 모서리가 교차하지만, 꼭지점 $d$를 삼각형 $abc$ **안쪽**에 놓으면 교차 없이 그릴 수 있다!

**결론**: $K_4$는 **평면 그래프**이다. ✅

### 2.2 예제 2: $Q_3$는 평면 그래프인가?

**3-큐브 그래프** $Q_3$는 8개의 꼭지점(000부터 111까지)과 12개의 모서리를 가진다.

$Q_3$도 적절히 재배치하면 교차 없이 그릴 수 있다.

**결론**: $Q_3$는 **평면 그래프**이다. ✅

### 2.3 예제 3: $K_{3,3}$은 평면 그래프인가? — 집과 공공 시설 문제

$K_{3,3}$ — 3개의 집과 3개의 공공 시설(전기, 가스, 수도)을 교차 없이 연결할 수 있을까?

```
  K₃,₃:
  v₁    v₂    v₃    ← 집 (첫 번째 그룹)
   │╲   │╲   │
   │  ╲  │  ╲ │
   │   ╲│   ╲│
  v₄    v₅    v₆    ← 공공시설 (두 번째 그룹)
```

**결론**: $K_{3,3}$은 **비평면**(nonplanar)이다. ❌

**증명 아이디어**: $K_{3,3}$의 평면 표현에서 $v_1$과 $v_2$는 두 꼭지점 $v_4$와 $v_5$에 연결해야 한다. 이 네 개의 모서리는 평면을 두 영역 $R_1, R_2$로 분할하는 폐곡선을 형성한다. 꼭지점 $v_3$는 $R_1$ 혹은 $R_2$ 안에 있다. $v_3$가 $R_2$ 안에 있다면, $v_3$와 $v_4$ 사이에 모서리와 $v_3$와 $v_5$ 사이의 모서리는 $R_2$를 다시 두 부분 영역 $R_{21}$과 $R_{22}$로 분할한다.

교차 없이 마지막 꼭지점 $v_6$를 넣는 것은 불가능하다:
- $v_6$가 $R_1$에 있다면 $v_6$와 $v_3$ 사이의 모서리는 교차 없이 그릴 수 없다.
- $v_6$가 $R_{21}$에 있다면 $v_6$와 $v_2$ 사이의 모서리는 교차 없이 그릴 수 없다.
- $v_6$가 $R_{22}$에 있다면 $v_6$와 $v_1$ 사이의 모서리는 교차 없이 그릴 수 없다.

유사한 논증을 $v_3$가 $R_1$ 내에 있을 때도 사용할 수 있다.

결론적으로 $K_{3,3}$은 **비평면**이다.

> 이것은 이 절의 첫 부분에 기술한 공공 시설과 집 문제에 대한 답이다. 세 집이 세 개의 공공 시설을 교차하지 않고 평면으로 연결할 수 없다.

---

## 3. 평면 그래프의 응용

그래프의 평면성은 다양한 분야에서 중요한 역할을 한다:

### 3.1 전자 회로 설계 🖥️

순환의 각 요소들을 꼭지점으로, 요소들 간의 연결을 모서리로 표현하는 그래프로 순환을 모델링할 수 있다. 순환을 표현하는 그래프가 평면이라면, 연결이 교차하지 않도록 하나의 보드에 순환을 인쇄할 수 있다. 그래프가 평면이 아닐 때에는 비용이 더 많이 든다.

### 3.2 도로망 설계 🛣️

그래프를 평면화하는 것은 도로망의 설계에 유용하다. 단순 그래프를 사용하여 이 도시들을 연결하는 도로망을 모델링할 때, 도시를 꼭지점으로 표시하고 도시 간 고속도로는 모서리로 나타낸다. 그 결과 그래프가 평면 그래프라면 지하 교차도로나 고가 교차도로를 사용하지 않고 도로망을 구축할 수 있다.

---

## 4. 오일러 공식 — 평면 그래프의 마법 등식

### 4.1 영역(region)이란?

그래프의 평면 표현은 무한한 영역을 포함하여 면을 **영역들**(regions)로 분할한다.

```
     ●───────●
    ╱│  R₄  ╱│
   ╱ │    ╱  │
  ●──┼──●   │ R₆
  │R₁│ R₃│   │
  │  ●───┼──●
  │ ╱ R₅ │ ╱
  │╱      │╱
  ●───────●
     R₂
```

위 그래프에서 평면은 **6개의 영역**으로 분할된다: $R_1, R_2, R_3, R_4, R_5$는 유한한 영역이고, $R_6$은 그래프 바깥의 **무한한 영역**(unbounded region)이다.

> **중요**: 무한한 영역(바깥쪽)도 항상 하나의 영역으로 센다!

그래프에 대한 평면 표현은 면을 같은 수의 영역들로 분할한다는 것을 오일러가 증명했다. 그는 평면 그래프에서 **영역의 수, 꼭지점의 수, 모서리의 수** 사이의 관계를 찾음으로 이를 보였다.

### 4.2 오일러 공식 (정리 1)

> **정리 1** (오일러 공식, Euler's Formula)
>
> 그래프 $G$는 $e$개의 모서리들과 $v$개의 꼭지점들을 갖는 **연결 평면 단순 그래프**라 하자. $r$을 $G$의 평면 표현에서 영역의 수라 하자. 오일러 공식은 다음과 같다.
>
> $$r = e - v + 2$$

이것은 정말 놀라운 공식이다! 어떤 연결 평면 그래프든, 이 등식이 **항상** 성립한다.

> **쉽게 기억하기**: $v - e + r = 2$ (꼭지점 - 모서리 + 영역 = 2)
>
> "VER = 2" 🎯 (Vertices - Edges + Regions = 2)

### 4.3 오일러 공식 증명의 핵심 아이디어 🎓

증명은 **수학적 귀납법**을 사용한다. 모서리를 하나씩 추가하면서 공식이 유지됨을 보인다.

**기본 사례** (모서리 1개): 
$G_1$은 하나의 모서리와 두 개의 꼭지점을 가진다. $e_1 = 1, v_1 = 2, r_1 = 1$ (영역은 무한 영역 하나뿐). $r_1 = e_1 - v_1 + 2 = 1 - 2 + 2 = 1$ ✅

**귀납 단계**: $G_k$에서 $r_k = e_k - v_k + 2$가 성립한다고 가정하자. $G_k$에 모서리 하나를 추가하여 $G_{k+1}$을 만들 때:

- **경우 1**: 새 모서리의 두 끝점이 이미 $G_k$에 존재 → 새 영역이 하나 생긴다.
  - $r_{k+1} = r_k + 1$, $e_{k+1} = e_k + 1$, $v_{k+1} = v_k$
  - $r_{k+1} = (r_k + 1) = (e_k - v_k + 2) + 1 = (e_k + 1) - v_k + 2 = e_{k+1} - v_{k+1} + 2$ ✅

- **경우 2**: 새 모서리의 한 끝점이 새로 추가됨 → 새 영역은 생기지 않는다.
  - $r_{k+1} = r_k$, $e_{k+1} = e_k + 1$, $v_{k+1} = v_k + 1$
  - $r_{k+1} = r_k = e_k - v_k + 2 = (e_k + 1) - (v_k + 1) + 2 = e_{k+1} - v_{k+1} + 2$ ✅

### 4.4 Lean 4에서 오일러 공식 형식화

```lean
-- 오일러 공식의 조합적 표현
-- 연결 평면 단순 그래프에서: r = e - v + 2 (즉, v - e + r = 2)
theorem euler_formula_planar
    (v e r : ℕ)           -- 꼭지점 수, 모서리 수, 영역 수
    (hv : v ≥ 1)          -- 꼭지점이 최소 1개
    (hconn : True)        -- 연결됨 (추상적으로)
    (hplanar : True)      -- 평면임 (추상적으로)
    (h_euler : v - e + r = 2)  -- 오일러 공식 가정
    : r = e - v + 2 := by
  omega

-- 구체적 검증: 사면체 (K₄)
-- v = 4, e = 6, r = 4 (삼각형 3개 + 바깥 1개)
example : 4 - 6 + 4 = 2 := by norm_num  -- 오일러 공식 ✅
```

### 4.5 예제 4: 오일러 공식 적용

> 연결된 평면 단순 그래프가 20개의 꼭지점을 갖고 각각의 차수가 3이라 하자. 이 평면 그래프 표현은 면을 몇 개의 영역으로 분할하는가?

**풀이**:
1. $v = 20$, 각 꼭지점의 차수 = 3
2. **악수 정리**: 차수의 합 = $3 \times 20 = 60 = 2e$ → $e = 30$
3. **오일러 공식**: $r = e - v + 2 = 30 - 20 + 2 = 12$

```lean
-- 예제 4: 20개 꼭지점, 차수 3인 평면 그래프
example : 30 - 20 + 2 = 12 := by norm_num

-- 악수 정리에서 모서리 수 계산
-- 차수의 합 = 3 * 20 = 60 = 2e → e = 30
example : 3 * 20 / 2 = 30 := by norm_num
```

---

## 5. 따름정리들 — 비평면 그래프를 걸러내는 도구

오일러 공식은 평면 그래프에 의해서 만족되는 몇 가지 **부등식**을 성립시킨다. 이 부등식을 만족하지 않으면 비평면 그래프라고 판별할 수 있다!

### 5.1 따름정리 1: 모서리 수의 상한

> **따름정리 1**
>
> $G$가 $e$개의 모서리와 $v$개의 꼭지점을 갖는 **연결 평면 단순 그래프**이고, $v \ge 3$이면
>
> $$e \le 3v - 6$$

**쉽게 기억하기**: "모서리는 꼭지점의 3배에서 6을 뺀 것보다 많을 수 없다!" 📏

### 5.2 따름정리 1의 증명 아이디어

**영역의 차수**(degree of a region)라는 개념을 사용한다. 차수는 영역의 경계 위의 모서리 수로 정의한다. 한 모서리는 경계에서 2번 사용되면(경계선을 따라갈 때 모서리가 2번 방문되면) 모서리의 차수에 2번 기여한다. 영역 $R$의 차수를 $\deg(R)$로 표기한다.

연결 평면 단순 그래프는 평면을 영역들, $r$로 나눈다. 각 영역의 차수는 적어도 3이다. (단순 그래프이므로 차수 2의 영역을 만들어내는 다중모서리나 차수 1의 영역을 만들어내는 루프는 허용되지 않는다.) 그래프에서 적어도 3개의 꼭지점이 존재하기 때문에 무한 영역의 차수는 적어도 3이다.

영역의 차수의 합은 그래프 모서리 수의 두 배이다. 왜냐하면 각 모서리는 한 영역의 경계 위에서 두 번 발생한다(두 개의 다른 영역에서 혹은 같은 영역에서 두 개). 각 영역은 3보다 크거나 같은 차수를 가지다. 각 영역이 3과 같거나 큰 차수를 갖기 때문에,

$$2e = \sum_{\text{all regions } R} \deg(R) \ge 3r$$

그러므로 $(2/3)e \ge r$이 성립한다. $r = e - v + 2$(오일러 공식)을 사용하여 $e - v + 2 \le (2/3)e$를 얻는다. 이것으로부터 $e/3 \le v - 2$이다. 따라서 $e \le 3v - 6$이다.

### 5.3 Lean 4에서 따름정리 1

```lean
-- 따름정리 1: 연결 평면 단순 그래프에서 e ≤ 3v - 6
-- (v ≥ 3일 때)
theorem corollary1_planar
    (v e : ℕ)
    (hv : v ≥ 3)
    (hplanar : True)      -- 평면 가정
    (h_bound : e ≤ 3 * v - 6)  -- 따름정리 1의 결론
    : e ≤ 3 * v - 6 := h_bound

-- 대우 형태: e > 3v - 6 이면 비평면!
-- 이것이 더 유용하다 — 비평면성을 판별하는 도구
theorem nonplanar_if_too_many_edges
    (v e : ℕ)
    (hv : v ≥ 3)
    (h_many : e > 3 * v - 6)
    : ¬ (e ≤ 3 * v - 6) := by
  omega
```

### 5.4 예제 5: $K_5$가 비평면임을 보이기

> **문제**: 따름정리 1을 사용하여 $K_5$가 비평면임을 보여라.

**풀이**: 
- $K_5$는 5개의 꼭지점과 10개의 모서리를 갖는다 ($\binom{5}{2} = 10$).
- 따름정리 1에 의하면 평면이면 $e \le 3v - 6$이어야 한다.
- $3v - 6 = 3 \times 5 - 6 = 9$
- 그런데 $e = 10 > 9$ → **따름정리 1을 위반**!
- 그러므로 $K_5$는 **비평면**이다. ✅

```lean
-- K₅ 비평면 증명
-- v = 5, e = 10, 3v - 6 = 9, e > 3v - 6 이므로 비평면
example : 10 > 3 * 5 - 6 := by norm_num
-- 10 > 9 ✅ → K₅는 비평면!
```

> **$K_{3,3}$은 어떤가?** $K_{3,3}$은 6개의 꼭지점과 9개의 모서리를 가진다. $3v - 6 = 3 \times 6 - 6 = 12$. 이것은 $e = 9 \le 12$를 만족한다! 결론적으로 부등식 $e \le 3v - 6$을 만족한다는 것은 그래프가 평면이라는 것을 의미하는 것은 아니다. 그러나 정리 1의 다음의 따름정리는 $K_{3,3}$이 비평면이라는 것을 증명하는 데 사용될 수 있다.

---

### 5.5 따름정리 2: 차수 5 이하의 꼭지점 존재

> **따름정리 2**
>
> $G$가 연결 평면 단순 그래프이면, $G$에는 **차수가 5를 초과하지 않는 꼭지점**이 존재한다.

**증명**: $G$가 1 또는 2개의 꼭지점을 가진다면 결과는 참이다. $G$가 3 이상의 꼭지점을 가진다면 따름정리 1에 의해 $e \le 3v - 6$이므로 $2e \le 6v - 12$이다. 모든 꼭지점의 차수가 적어도 6이면 $2e = \sum_{v \in V} \deg(v) \ge 6v$이다. 그러나 이것은 따름정리 1에 모순된다. 그러므로 차수가 5를 초과하지 않는 꼭지점이 존재하여야 한다.

직관적으로 말하면: "평면 그래프는 너무 빽빽할 수 없다 — 항상 연결이 적은 꼭지점이 있다!"

```lean
-- 따름정리 2의 대우 형태:
-- 모든 꼭지점의 차수가 6 이상이면 비평면
-- 증명: 악수 정리에 의해 2e = Σdeg(v) ≥ 6v → e ≥ 3v
--       따름정리 1에 의해 e ≤ 3v - 6, 이는 e ≥ 3v와 모순
theorem corollary2_contrapositive
    (v e : ℕ)
    (hv : v ≥ 3)
    (h_all_deg_ge_6 : 2 * e ≥ 6 * v)  -- 모든 차수 ≥ 6
    (h_euler_bound : e ≤ 3 * v - 6)   -- 따름정리 1
    : False := by
  omega
```

### 5.6 따름정리 3: 삼각형 없는 그래프의 모서리 상한

> **따름정리 3**
>
> 연결 평면 단순 그래프가 $e$개의 모서리와 $v \ge 3$인 $v$개의 꼭지점과 길이 3의 순환을 갖지 않으면,
>
> $$e \le 2v - 4$$

따름정리 3의 증명은 길이 3의 순환을 갖지 않는 사실이 한 영역의 차수가 최소 4라는 것을 의미한다는 점을 제외하고는 따름정리 1의 증명과 유사하다.

> **이분 그래프**(bipartite graph)는 길이 3의 순환(삼각형)을 포함하지 않으므로 이 따름정리를 적용할 수 있다!

```lean
-- 따름정리 3: 삼각형 없는 연결 평면 그래프에서 e ≤ 2v - 4
theorem corollary3_triangle_free
    (v e : ℕ)
    (hv : v ≥ 3)
    (h_no_triangle : True)  -- 길이 3의 순환 없음
    (h_bound : e ≤ 2 * v - 4)
    : e ≤ 2 * v - 4 := h_bound
```

### 5.7 예제 6: 따름정리 3으로 $K_{3,3}$이 비평면임을 보이기

> **문제**: 따름정리 3을 사용하여 $K_{3,3}$이 비평면임을 보여라.

**풀이**: 
- $K_{3,3}$은 **이분 그래프**이므로 길이 3의 순환이 존재하지 않는다. (이분 그래프에는 홀수 길이의 순환이 없다!)
- 따름정리 3을 사용할 수 있다.
- $K_{3,3}$은 6개의 꼭지점과 9개의 모서리를 가진다.
- $e = 9$와 $2v - 4 = 2 \times 6 - 4 = 8$
- $9 > 8$ → **따름정리 3을 위반**!
- 따름정리 3은 $K_{3,3}$이 비평면이라는 것을 보여준다. ✅

```lean
-- K₃,₃ 비평면 증명 (따름정리 3 사용)
-- 삼각형 없는(이분) 그래프이므로 e ≤ 2v - 4 적용
-- v = 6, e = 9, 2v - 4 = 8
example : 9 > 2 * 6 - 4 := by norm_num
-- 9 > 8 ✅ → K₃,₃는 비평면!
```

---

## 6. 연습 문제 — 빈칸 채우기 (Skeleton)

### 연습 6.1: 오일러 공식 검증 — 정육면체 그래프 (빈칸 채우기)

**정육면체 그래프** ($Q_3$과 같다): $v = 8$, $e = 12$

**문제**: 오일러 공식을 사용하여 영역 수를 구하라.

```lean
-- 정육면체 그래프의 오일러 공식 검증
-- v = 8, e = 12
-- r = e - v + 2 = ?
example : 12 - 8 + 2 = ⟨??⟩ := by norm_num
```

<details>
<summary>📝 답 보기</summary>

```lean
example : 12 - 8 + 2 = 6 := by norm_num
-- r = 6 (정육면체의 6개의 면!)
```

</details>

### 연습 6.2: 따름정리 1 적용 — K₆ (빈칸 채우기)

**문제**: $K_6$는 평면 그래프인가? 따름정리 1을 사용하여 판별하라.

$K_6$: $v = 6$, $e = \binom{6}{2} = 15$

```lean
-- K₆의 비평면성 검증
-- v = 6, e = 15, 3v - 6 = ?
-- e > 3v - 6 인지 확인

-- 먼저 3v - 6을 계산하라:
example : 3 * 6 - 6 = ⟨??⟩ := by norm_num

-- e > 3v - 6 인지 확인하라:
example : 15 > ⟨??⟩ := by norm_num
```

<details>
<summary>📝 답 보기</summary>

```lean
example : 3 * 6 - 6 = 12 := by norm_num
example : 15 > 12 := by norm_num
-- 15 > 12 이므로 K₆는 비평면! ✅
```

</details>

### 연습 6.3: 따름정리 3 적용 — K₃,₄ (빈칸 채우기)

**문제**: $K_{3,4}$는 평면 그래프인가? (이분 그래프이므로 따름정리 3 사용)

$K_{3,4}$: $v = 7$, $e = 3 \times 4 = 12$ (이분 그래프이므로 삼각형 없음)

```lean
-- K₃,₄의 비평면성 검증
-- v = 7, e = 12, 2v - 4 = ?

-- 2v - 4를 계산하라:
example : 2 * 7 - 4 = ⟨??⟩ := by norm_num

-- e > 2v - 4 인지 확인하라:
example : 12 > ⟨??⟩ := by norm_num
```

<details>
<summary>📝 답 보기</summary>

```lean
example : 2 * 7 - 4 = 10 := by norm_num
example : 12 > 10 := by norm_num
-- 12 > 10 이므로 K₃,₄는 비평면! ✅
```

</details>

### 연습 6.4: 꼭지점과 모서리 수에서 영역 수 구하기 (sorry)

**문제**: 연결 평면 그래프가 8개의 꼭지점과 각 꼭지점의 차수가 3이라 하자. 이 그래프의 평면 표현에 의해 면은 몇 개의 영역으로 분할될 수 있는가? (Rosen 연습문제 12)

```lean
-- 악수 정리: 2e = 3 * 8 = 24 → e = 12
-- 오일러 공식: r = e - v + 2 = 12 - 8 + 2 = 6

-- 모서리 수 계산
theorem exercise_12_edges : sorry := by
  sorry

-- 영역 수 계산
theorem exercise_12_regions : sorry := by
  sorry
```

<details>
<summary>📝 답 보기</summary>

```lean
-- 악수 정리: 2e = Σdeg(v) = 3 × 8 = 24 → e = 12
example : 3 * 8 / 2 = 12 := by norm_num

-- 오일러 공식: r = e - v + 2 = 12 - 8 + 2 = 6
example : 12 - 8 + 2 = 6 := by norm_num
-- 영역 수는 6이다! ✅
```

</details>

### 연습 6.5: 꼭지점과 모서리에서 영역 수 (sorry)

**문제**: 연결 평면 그래프가 6개의 꼭지점과 각 꼭지점의 차수가 4라 하자. 이 그래프의 평면 표현에 의해 면은 몇 개의 영역으로 분할될 수 있는가? (Rosen 연습문제 13)

```lean
-- 풀이를 완성하라:
-- 악수 정리: 2e = ? → e = ?
-- 오일러 공식: r = e - v + 2 = ?

theorem exercise_13 : sorry := by
  sorry
```

<details>
<summary>📝 답 보기</summary>

```lean
-- 악수 정리: 2e = 4 × 6 = 24 → e = 12
example : 4 * 6 / 2 = 12 := by norm_num

-- 오일러 공식: r = 12 - 6 + 2 = 8
example : 12 - 6 + 2 = 8 := by norm_num
-- 영역 수는 8이다! ✅
```

</details>

### 연습 6.6: 평면 그래프의 모서리에서 꼭지점 수 구하기 (sorry)

**문제**: 연결 평면 그래프가 30개의 모서리를 가진다고 하자. 이 그래프의 평면 표현은 면을 20개의 영역으로 나눈다면 이 그래프가 갖는 꼭지점의 수를 구하라. (Rosen 연습문제 14)

```lean
-- 오일러 공식: v = e - r + 2 = 30 - 20 + 2 = ?
theorem exercise_14 : sorry := by
  sorry
```

<details>
<summary>📝 답 보기</summary>

```lean
-- 오일러 공식: v - e + r = 2 → v = e - r + 2
example : 30 - 20 + 2 = 12 := by norm_num
-- 꼭지점 수는 12이다! ✅
```

</details>

### 연습 6.7: K₇ 비평면 판별 (sorry)

**문제**: 따름정리 1을 사용하여 $K_7$이 비평면임을 보여라.

```lean
-- K₇: v = 7, e = C(7,2) = 21
-- 3v - 6 = ?
-- e > 3v - 6?
theorem K7_nonplanar : sorry := by
  sorry
```

<details>
<summary>📝 답 보기</summary>

```lean
-- K₇: v = 7, e = 21
-- 3v - 6 = 3 × 7 - 6 = 15
-- 21 > 15 → 비평면!
example : 21 > 3 * 7 - 6 := by norm_num
```

</details>

### 연습 6.8: K₄,₄ 비평면 판별 (sorry)

**문제**: $K_{4,4}$는 평면 그래프인가? 이분 그래프이므로 따름정리 3을 사용하라.

```lean
-- K₄,₄: v = 8, e = 4 × 4 = 16 (이분 그래프 → 삼각형 없음)
-- 2v - 4 = ?
-- e > 2v - 4?
theorem K44_nonplanar : sorry := by
  sorry
```

<details>
<summary>📝 답 보기</summary>

```lean
-- K₄,₄: v = 8, e = 16
-- 2v - 4 = 2 × 8 - 4 = 12
-- 16 > 12 → 비평면!
example : 16 > 2 * 8 - 4 := by norm_num
```

</details>

### 연습 6.9: 따름정리의 한계 이해하기 (서술형)

**문제**: 그래프가 $e \le 3v - 6$을 만족한다고 해서 반드시 평면인가? $K_{3,3}$의 예를 들어 설명하라.

<details>
<summary>📝 답 보기</summary>

**아니다!** $e \le 3v - 6$은 평면의 **필요조건**이지 **충분조건**이 아니다.

$K_{3,3}$: $v = 6, e = 9, 3v - 6 = 12$. $9 \le 12$를 만족하지만 $K_{3,3}$은 비평면이다!

이것이 바로 $\to$(if)와 $\leftrightarrow$(iff)의 차이이다:
- "평면 → $e \le 3v - 6$" (따름정리 1, 이것은 참)
- "$e \le 3v - 6$ → 평면" (이것은 거짓! $K_{3,3}$이 반례)
- 따라서 "평면 $\leftrightarrow$ $e \le 3v - 6$"은 성립하지 않는다

이것은 $\to$ (if)와 $\leftrightarrow$ (if and only if)의 차이를 보여주는 좋은 예이다:
```lean
-- → (if): 평면이면 e ≤ 3v - 6 (참)
-- 대우: e > 3v - 6이면 비평면 (참)
-- 역: e ≤ 3v - 6이면 평면 (거짓! K₃,₃가 반례)
-- ↔ (iff): 평면 ↔ e ≤ 3v - 6 (거짓!)
```

삼각형 없는 그래프에서는 따름정리 3 ($e \le 2v - 4$)을 사용해야 하며, 이것으로 $K_{3,3}$의 비평면성을 보일 수 있다.

</details>

---

## 7. 핵심 개념 정리: →(if) vs ↔(iff) — 따름정리를 통해 이해하기

이 파트의 따름정리들은 **→(if)와 ↔(iff)의 차이**를 이해하는 아주 좋은 예이다.

### 7.1 따름정리 1은 →(if) 방향만!

```
평면 → e ≤ 3v - 6     ✅ (따름정리 1)
e ≤ 3v - 6 → 평면     ❌ (K₃,₃가 반례)
평면 ↔ e ≤ 3v - 6     ❌ (양방향이 아님)
```

따름정리 1의 **대우**(contrapositive)는 유용하다:
```
e > 3v - 6 → 비평면   ✅
```

### 7.2 Lean 4에서 →와 ↔

```lean
-- → (if): P → Q
-- "P이면 Q이다"
-- 한 방향만 보장

-- ↔ (iff): P ↔ Q  
-- "P이면 Q이고, Q이면 P이다"
-- 양방향 모두 보장

-- 따름정리 1은 → 방향만:
-- isPlanar G → G.edgeCount ≤ 3 * G.vertexCount - 6

-- 오일러의 판별 조건 (오일러 순환)은 ↔:
-- hasEulerCircuit G ↔ G.isConnected ∧ ∀ v, Even (G.degree v)
```

### 7.3 대우(contrapositive)의 위력

```lean
-- 원래 명제: P → Q
-- 대우:      ¬Q → ¬P (항상 동치!)

-- 따름정리 1의 대우:
-- e > 3v - 6 → 비평면
-- → 이것으로 K₅의 비평면성을 증명!

-- Lean 4에서 대우 사용:
theorem contrapositive_demo (P Q : Prop) 
    (h : P → Q) (hnq : ¬Q) : ¬P := by
  intro hp
  exact hnq (h hp)
```

---

## 8. lemma(작은 정리)와 theorem(큰 정리)의 관계 — 오일러 공식 분해

이 파트의 내용은 **lemma와 theorem의 관계**를 이해하기에도 좋다.

### 8.1 오일러 공식의 구조

**큰 정리** (theorem): 오일러 공식 $r = e - v + 2$

이 정리를 증명하기 위해 여러 **작은 정리** (lemma)가 필요하다:

- **lemma 1**: 기본 사례 — 모서리 1개일 때 $r = 1 = 1 - 2 + 2$
- **lemma 2**: 두 끝점이 이미 존재할 때 모서리 추가 → 영역 +1
- **lemma 3**: 새 끝점을 추가할 때 모서리 추가 → 영역 변화 없음

```lean
-- Lean 4에서 lemma와 theorem은 완전히 같다!
-- 관례적으로:
--   lemma: 다른 정리의 디딤돌
--   theorem: 최종 결과

-- lemma (디딤돌)
lemma euler_base_case : 1 - 2 + 2 = 1 := by norm_num

-- lemma (디딤돌) 
lemma euler_step_case1 (r e v : ℕ) (h : r = e - v + 2) :
    (r + 1) = (e + 1) - v + 2 := by omega

-- theorem (최종 결과) — lemma들을 조합
theorem euler_formula (v e r : ℕ) (hconn : True) (hplanar : True)
    (h : v + r = e + 2) : r = e - v + 2 := by
  omega
```

### 8.2 따름정리(corollary)란?

**따름정리**(corollary)는 이미 증명된 정리로부터 **쉽게** 유도되는 정리이다.

```
오일러 공식 (theorem)
  ├── 따름정리 1: e ≤ 3v - 6  (corollary)
  ├── 따름정리 2: ∃v, deg(v) ≤ 5  (corollary)
  └── 따름정리 3: 삼각형 없으면 e ≤ 2v - 4  (corollary)
```

Lean 4에서 따름정리는 보통 `theorem`으로 선언하되, 증명에서 원래 정리를 직접 사용한다:

```lean
-- 오일러 공식으로부터 따름정리 1 유도
theorem corollary1_from_euler
    (v e r : ℕ)
    (hv : v ≥ 3)
    (h_euler : v + r = e + 2)  -- v - e + r = 2, 즉 v + r = e + 2
    (h_deg : 2 * e ≥ 3 * r)   -- 각 영역의 차수 ≥ 3
    : e ≤ 3 * v - 6 := by
  -- 2e ≥ 3r 에서 r ≤ 2e/3
  -- v + r = e + 2에서 r = e + 2 - v
  -- 따라서 e + 2 - v ≤ 2e/3
  -- 3(e + 2 - v) ≤ 2e
  -- 3e + 6 - 3v ≤ 2e
  -- e ≤ 3v - 6
  omega
```

---

## 9. 치환(슈퍼포지션) 복습 — 오일러 공식을 활용한 변형

**치환**(substitution, superposition)은 등식이나 동치를 이용해 식의 일부를 바꾸는 것이다. 오일러 공식의 활용이 치환의 좋은 예이다:

```lean
-- 오일러 공식: r = e - v + 2
-- 이를 이용해 다른 식에서 r을 e - v + 2로 치환할 수 있다

-- 예: "2e ≥ 3r" 에서 r을 치환
-- → "2e ≥ 3(e - v + 2)"
-- → "2e ≥ 3e - 3v + 6"
-- → "3v - 6 ≥ e"

example (v e r : ℕ) 
    (h_euler : r = e - v + 2)
    (h_deg : 2 * e ≥ 3 * r) :
    e ≤ 3 * v - 6 := by
  rw [h_euler] at h_deg  -- r을 e - v + 2로 치환! (슈퍼포지션)
  omega
```

> **rw는 = 뿐 아니라 변수도 치환할 수 있다!** `rw [h_euler] at h_deg`는 `h_deg`에서 `r`을 `e - v + 2`로 치환한다. 이것이 바로 **슈퍼포지션**(superposition) — 등식을 이용한 치환이다.

---

## 10. 핵심 요약

1. **평면 그래프**(planar graph)는 모서리가 교차하지 않도록 평면에 그릴 수 있는 그래프이다.
2. **평면 표현**(planar representation)은 평면을 **영역**(region)들로 분할한다.
3. **오일러 공식**: 연결 평면 단순 그래프에서 $r = e - v + 2$ (VER = 2).
4. **따름정리 1**: $e \le 3v - 6$ → 대우: $e > 3v - 6$이면 비평면.
5. **따름정리 2**: 평면 그래프에는 차수 5 이하의 꼭지점이 반드시 존재.
6. **따름정리 3**: 삼각형 없는 연결 평면 그래프에서 $e \le 2v - 4$.
7. $K_5$는 따름정리 1로 비평면 ($10 > 9$).
8. $K_{3,3}$은 따름정리 3으로 비평면 ($9 > 8$).
9. $e \le 3v - 6$은 **필요조건**이지 **충분조건**이 아니다 (→ vs ↔).
10. **lemma**: 디딤돌 정리, **theorem**: 최종 정리, **corollary**: 쉽게 유도되는 정리.
11. **슈퍼포지션**: `rw`로 등식/동치를 이용해 치환하기.

---

## 11. 사용된 Lean 4 전술 정리

| 전술/키워드 | 용도 | 예시 |
|:---|:---|:---|
| `norm_num` | 수치 계산 | `example : 10 > 9 := by norm_num` |
| `omega` | 자연수/정수 부등식 | `omega` — 선형 부등식 자동 해결 |
| `rw [...] at h` | 가설에서 치환 | `rw [h_euler] at h_deg` |
| `intro` | 가정 도입 | `intro hp` |
| `exact` | 정확한 증명 항 | `exact hnq (h hp)` |
| `by_contra` | 귀류법 | `by_contra h` |
| `lemma` / `theorem` | 동일 기능 | 관례적 차이만 있음 |

---

> **다음 파트 예고**: Part 13-K에서는 **쿠라토우스키의 정리**(Kuratowski's theorem)와 **그래프 채색**(graph coloring)을 다룬다. 쿠라토우스키 정리는 비평면 그래프의 **필요충분조건**을 제시하며, 그래프 채색은 **4색 정리**(four color theorem)와 관련된 유명한 문제이다!
